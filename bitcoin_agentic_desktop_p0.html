<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Agentic Desktop - P0 Core Features</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Geist:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        :root {
            --background: #ffffff;
            --foreground: #0a0a0a;
            --card: #ffffff;
            --card-foreground: #0a0a0a;
            --primary: #000000;
            --primary-foreground: #ffffff;
            --secondary: #f4f4f5;
            --secondary-foreground: #71717a;
            --muted: #f4f4f5;
            --muted-foreground: #71717a;
            --accent: #f4f4f5;
            --accent-foreground: #18181b;
            --destructive: #ef4444;
            --destructive-foreground: #ffffff;
            --border: #e4e4e7;
            --input: #e4e4e7;
            --ring: #18181b;
            --radius: 8px;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Geist', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #fafafa 0%, #f4f4f5 100%);
            color: var(--foreground);
            font-size: 14px;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        .container {
            max-width: 1920px;
            margin: 0 auto;
            padding: 1.5rem;
            min-height: 100vh;
        }

        .grid-layout {
            display: grid;
            grid-template-columns: 30% 40% 30%;
            gap: 1.5rem;
            height: calc(100vh - 3rem);
            width: 100%;
            align-items: start;
        }

        /* Dynamic Height Adjustment */
        .middle-panel, .right-panel {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .left-panel {
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            padding-right: 0.25rem; /* Subtle spacing for scrollbar */
        }

        /* Custom Scrollbar Styling */
        .left-panel::-webkit-scrollbar {
            width: 6px;
        }

        .left-panel::-webkit-scrollbar-track {
            background: transparent;
        }

        .left-panel::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .left-panel::-webkit-scrollbar-thumb:hover {
            background: var(--muted-foreground);
        }

        /* Panel Height Synchronization */
        .panel-sync {
            transition: min-height 0.3s ease-out;
        }

        /* Responsive Design */
        @media (max-width: 1400px) {
            .grid-layout {
                grid-template-columns: 28% 44% 28%;
                gap: 1.25rem;
            }
            
            .container {
                padding: 1.25rem;
            }
        }

        @media (max-width: 1200px) {
            .grid-layout {
                grid-template-columns: 26% 48% 26%;
                gap: 1rem;
            }
            
            .container {
                padding: 1rem;
            }
        }

        @media (max-width: 1024px) {
            .grid-layout {
                grid-template-columns: 25% 50% 25%;
                gap: 0.75rem;
            }
            
            .container {
                padding: 0.75rem;
            }
        }

        @media (max-width: 768px) {
            .grid-layout {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
                gap: 1rem;
                height: auto;
            }
            
            .container {
                padding: 0.5rem;
            }
            
            .left-panel,
            .middle-panel, 
            .right-panel {
                height: auto;
                min-height: auto;
            }
        }

        /* Case Summary Pill */
        .case-summary-pill {
            background: var(--muted);
            color: var(--foreground);
            border: 1px solid var(--border);
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow-sm);
        }

        .case-summary-pill:hover {
            background: var(--accent);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .case-summary-pill.expanded {
            border-radius: 1rem 1rem 0 0;
            margin-bottom: 0;
            background: var(--background);
            border: 1px solid var(--border);
        }

        .case-summary-content {
            background: var(--muted);
            border: 1px solid var(--border);
            border-top: none;
            border-radius: 0 0 1rem 1rem;
            padding: 1rem;
            margin-bottom: 1rem;
            display: none;
        }

        .case-summary-content.expanded {
            display: block;
        }

        /* Knowledge Pills */
        .knowledge-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: var(--muted/30);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .knowledge-pill {
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--muted-foreground);
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }

        .knowledge-pill:hover {
            background: var(--accent);
            color: var(--foreground);
            transform: translateY(-1px);
        }

        /* Enhanced scrollable containers */
        .scrollable-container {
            overflow-y: auto;
            overflow-x: hidden;
            height: 100%;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 1rem;
            padding-bottom: 1rem;
        }

        .copilot-messages-container {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 1rem;
            padding-bottom: 1rem;
        }

        /* Enhanced scrollbar for message containers */
        .messages-container::-webkit-scrollbar,
        .copilot-messages-container::-webkit-scrollbar {
            width: 6px;
        }

        .messages-container::-webkit-scrollbar-track,
        .copilot-messages-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .messages-container::-webkit-scrollbar-thumb,
        .copilot-messages-container::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .messages-container::-webkit-scrollbar-thumb:hover,
        .copilot-messages-container::-webkit-scrollbar-thumb:hover {
            background: var(--muted-foreground);
        }

        /* Enhanced Card Styles */
        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 24px;
            box-shadow: 0px 12px 32px rgba(0, 0, 0, 0.04), 0px 8px 16px rgba(0, 0, 0, 0.02), 0px 2px 4px rgba(0, 0, 0, 0.04), 0px 0px 1px rgba(0, 0, 0, 0.2);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        .card:hover {
            box-shadow: var(--shadow-md);
        }

        .card-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            background: rgba(250, 250, 250, 0.5);
        }

        .card-content {
            padding: 1rem;
        }

        .card-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--card-foreground);
            margin: 0;
        }

        .card-description {
            font-size: 0.75rem;
            color: var(--muted-foreground);
            margin: 0.25rem 0 0 0;
        }

        /* Enhanced Badge Styles */
        .badge {
            display: inline-flex;
            align-items: center;
            border-radius: calc(var(--radius) - 2px);
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 500;
            line-height: 1;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .badge-primary {
            background: var(--primary);
            color: var(--primary-foreground);
        }

        .badge-secondary {
            background: var(--secondary);
            color: var(--secondary-foreground);
        }

        .badge-destructive {
            background: var(--destructive);
            color: var(--destructive-foreground);
        }

        .badge-outline {
            border: none;
            background: transparent;
            color: var(--foreground);
        }

        .badge-p0 {
            background: var(--muted);
            color: var(--foreground);
            border: 1px solid var(--border);
            font-weight: 600;
        }

        /* Enhanced Button Styles */
        .btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            letter-spacing: 0.025em;
            border: none;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--primary-foreground);
            border: none;
        }

        .btn-primary:hover {
            background: var(--primary);
            border: none;
        }

        .btn-secondary {
            background: var(--secondary);
            color: var(--secondary-foreground);
            padding: 0.5rem 1rem;
        }

        .btn-outline {
            background: var(--background);
            border: none;
            color: var(--foreground);
        }

        .btn-outline:hover {
            background: var(--accent);
            border: none;
        }

        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }

        .btn-ghost {
            background: transparent;
            color: var(--foreground);
            padding: 0.5rem 1rem;
        }

        .btn-ghost:hover {
            background: var(--accent);
        }

        /* Enhanced Segment Control */
        .segment-control {
            display: flex;
            background: var(--muted);
            border-radius: 6px;
            padding: 2px;
            margin-bottom: 1rem;
            border: 1px solid var(--border);
        }

        .segment-button {
            flex: 1;
            padding: 0.5rem 0.75rem;
            border-radius: 4px;
            background: transparent;
            border: none;
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--muted-foreground);
            cursor: pointer;
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.375rem;
            white-space: nowrap;
        }

        .segment-button:hover {
            color: var(--foreground);
            background: rgba(0, 0, 0, 0.05);
        }

        .segment-button.active {
            background: var(--background);
            color: var(--foreground);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            font-weight: 600;
        }

        /* Enhanced Input Styles */
        .input, .textarea {
            width: 100%;
            border-radius: calc(var(--radius) - 2px);
            border: 1px solid var(--input);
            background: var(--background);
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            transition: all 0.2s;
            font-family: inherit;
        }

        .input:focus, .textarea:focus {
            outline: none;
            border-color: var(--ring);
            box-shadow: 0 0 0 2px rgba(24, 24, 27, 0.1);
        }

        .textarea {
            min-height: 80px;
            resize: vertical;
        }

        /* Status Indicators */
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 0.5rem;
            animation: pulse-status 2s infinite;
        }

        @keyframes pulse-status {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .status-open { background: var(--muted-foreground); }
        .status-pending { background: #f59e0b; }
        .status-resolved { background: #10b981; }
        .status-escalated { background: #8b5cf6; }

        /* Invisible Scrollbars */
        .custom-scrollbar::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: transparent;
        }

        /* Message Styles */
        .message-bubble {
            max-width: 85%;
        }

        .customer-message, .advocate-message {
            transition: all 0.2s ease;
            border-radius: var(--radius);
            padding: 0.75rem;
        }

        .customer-message:hover,
        .advocate-message:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .advocate-message {
            background: linear-gradient(135deg, #000000 0%, #333333 100%);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 1rem 1rem 0.25rem 1rem;
            box-shadow: var(--shadow-sm);
        }

        .customer-message {
            background: var(--secondary);
            color: var(--secondary-foreground);
            padding: 0.75rem 1rem;
            border-radius: 1rem 1rem 1rem 0.25rem;
            box-shadow: var(--shadow-sm);
        }

        .copilot-message {
            background: var(--muted/30);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 0.75rem;
            line-height: 1.6;
            transition: all 0.2s ease;
        }

        .copilot-message:hover {
            background: var(--muted/40);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .copilot-message p {
            margin: 0;
        }

        .copilot-message h3, .copilot-message h4 {
            margin: 0 0 0.5rem 0;
        }

        .user-query {
            background: var(--accent);
            color: var(--accent-foreground);
            padding: 0.75rem 1rem;
            border-radius: 1rem 1rem 1rem 0.25rem;
            box-shadow: var(--shadow-sm);
        }

        /* BTC Specific Styles */
        .btc-balance {
            color: var(--foreground);
            font-weight: 600;
            font-family: 'Geist', monospace;
        }

        .btc-icon {
            color: #f7931a;
            filter: drop-shadow(0 1px 2px rgba(247, 147, 26, 0.3));
        }

        /* Interactive Elements */
        .interactive-card {
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .interactive-card:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .interactive-card:active {
            transform: translateY(0);
        }

        /* Confidence Bar */
        .confidence-bar {
            width: 100%;
            height: 4px;
            background: var(--secondary);
            border-radius: 2px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #ef4444 0%, #f59e0b 50%, #10b981 100%);
            border-radius: 2px;
            transition: width 0.8s ease-out;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.5rem 0.75rem;
            background: var(--secondary);
            border-radius: 1rem;
            width: fit-content;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--muted-foreground);
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* CSS Animations */
        .animate-fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
        }

        .animate-scale-in {
            animation: scaleIn 0.4s ease-out forwards;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .animate-bounce {
            animation: bounce 0.4s ease-out;
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .animate-click {
            animation: click 0.2s ease-out;
        }

        @keyframes click {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(0.95); }
        }

        /* Focus States */
        .focus-visible:focus {
            outline: 2px solid var(--ring);
            outline-offset: 2px;
        }

        /* Suggested Action Pills */
        .action-pill {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: var(--secondary);
            border: 1px solid var(--border);
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--foreground);
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 0.25rem;
        }

        .action-pill:hover {
            background: var(--accent);
            box-shadow: var(--shadow-sm);
            transform: translateY(-1px);
        }

        .action-pill.accepted {
            background: var(--primary);
            color: var(--primary-foreground);
            border-color: var(--primary);
        }

        .action-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border);
        }

        .action-preview {
            background: var(--muted);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin-top: 0.5rem;
            font-size: 0.875rem;
            color: var(--muted-foreground);
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease-out;
        }

        .notification.show {
            transform: translateX(0);
        }



        /* Customer Reply Suggestion Pills */
        .reply-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.75rem;
            margin-left: 0;
            width: 100%;
        }

        .reply-pill {
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--foreground);
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 0.375rem;
            box-shadow: var(--shadow-sm);
        }

        .reply-pill:hover {
            background: var(--accent);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* Help-seeking functionality - make consistent */
        .customer-message-wrapper {
            position: relative;
            width: 100%;
        }

        .help-trigger {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s;
            box-shadow: var(--shadow-sm);
            z-index: 10;
        }

        .customer-message-wrapper:hover .help-trigger {
            opacity: 1;
        }

        .help-trigger:hover {
            background: var(--accent);
            transform: scale(1.1);
        }



        /* Fixed chat input alignment */
        .chat-input-area {
            padding: 1rem;
            border-top: 1px solid var(--border);
            background: var(--background);
            margin-top: auto;
        }

        /* Enhanced customer information styles */
        .account-card {
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            transition: all 0.15s ease-out;
            cursor: pointer;
        }

        .account-card:hover {
            background: var(--accent);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .account-card:active {
            transform: translateY(0);
            transition: all 0.1s ease-out;
        }

        .account-card.active {
            background: var(--background);
            color: var(--foreground);
            box-shadow: var(--shadow-md);
            border: 2px solid var(--border);
            transform: none;
        }

        .account-card.active:hover {
            background: var(--background);
            transform: none;
        }

        .account-card.active:active {
            transform: none;
        }

        .account-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .account-labels {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            margin-top: 0.5rem;
        }

        .customer-labels {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            margin: 0.5rem 0;
        }

        /* Color Updates */
        .text-blue-600 {
            color: var(--foreground) !important;
        }
        
        .text-purple-600 {
            color: var(--muted-foreground) !important;
        }
        
        .text-purple-500 {
            color: var(--muted-foreground) !important;
        }
        
        .border-blue-600 {
            border-color: var(--border) !important;
        }
        
        .border-purple-600 {
            border-color: var(--border) !important;
        }

        /* Enhanced UI/UX Improvements */
        .message-bubble {
            max-width: 85%;
        }

        .customer-message, .advocate-message {
            transition: all 0.2s ease;
            border-radius: var(--radius);
            padding: 0.75rem;
        }

        .customer-message:hover,
        .advocate-message:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .reply-pill {
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--foreground);
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 0.375rem;
            box-shadow: var(--shadow-sm);
            white-space: nowrap;
            max-width: fit-content;
        }

        .reply-pill:hover {
            background: var(--accent);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
            border-color: var(--accent-foreground);
        }

        .reply-pill:active {
            transform: translateY(0);
            box-shadow: var(--shadow-sm);
        }

        /* Enhanced Card Interactions */
        .card {
            transition: all 0.2s ease;
            border-radius: var(--radius);
            overflow: hidden;
        }

        .card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .interactive-card {
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .interactive-card:hover {
            background: var(--accent);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .interactive-card:active {
            transform: translateY(0);
        }

        /* Enhanced Typography */
        .card-title {
            font-weight: 600;
            letter-spacing: -0.025em;
            line-height: 1.25;
        }

        .card-description {
            color: var(--muted-foreground);
            font-size: 0.875rem;
            line-height: 1.5;
        }

        /* Enhanced Status Indicators */
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Enhanced Badges */
        .badge {
            font-weight: 500;
            letter-spacing: 0.025em;
            transition: all 0.2s ease;
        }

        .badge-p0 {
            background: var(--muted);
            color: var(--foreground);
            border: 1px solid var(--border);
            font-weight: 600;
        }

        /* Enhanced Focus States */
        .focus-visible {
            outline: 2px solid var(--ring);
            outline-offset: 2px;
        }

        /* Enhanced Scrollbars */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: var(--muted);
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: var(--muted-foreground);
            border-radius: 3px;
            transition: background 0.2s ease;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: var(--foreground);
        }

        /* Enhanced Button States */
        .btn {
            transition: all 0.15s ease-out;
            font-weight: 500;
            letter-spacing: 0.025em;
            border: none;
        }

        .btn-outline {
            background: var(--background);
            border: none;
            color: var(--foreground);
        }

        .btn-outline:hover {
            background: var(--accent);
            border: none;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn:active {
            transform: translateY(0);
            transition: all 0.1s ease-out;
        }

        /* Enhanced Input States */
        .textarea, .input {
            transition: all 0.2s ease;
        }

        .textarea:focus, .input:focus {
            border-color: var(--ring);
            box-shadow: 0 0 0 2px rgba(var(--ring), 0.2);
        }

        /* Enhanced Avatar */
        .avatar {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
        }

        .avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* Enhanced Micro-interactions */
        .knowledge-pill {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .knowledge-pill:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .segment-button {
            transition: all 0.2s ease;
        }

        .segment-button:hover {
            background: var(--accent);
        }

        .segment-button.active {
            background: var(--primary);
            color: var(--primary-foreground);
        }

        /* Enhanced Loading States */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: var(--muted);
            border-radius: var(--radius);
            margin: 0.5rem 0;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: var(--muted-foreground);
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        /* Final Polish - Visual Hierarchy & Accessibility */
        .space-y-4 > * + * {
            margin-top: 1rem;
        }

        .space-y-3 > * + * {
            margin-top: 0.75rem;
        }

        .space-y-2 > * + * {
            margin-top: 0.5rem;
        }

        /* Enhanced Visual Feedback */
        .action-pill.accepted {
            background: var(--primary);
            color: var(--primary-foreground);
            border-color: var(--primary);
            transform: scale(0.95);
        }

        .action-pill.accepted:hover {
            transform: scale(0.95);
            cursor: default;
        }

        /* Enhanced Case Summary Pill */
        .case-summary-pill {
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .case-summary-pill:hover {
            background: var(--accent);
            transform: translateY(-1px);
        }

        .case-summary-pill.expanded {
            background: var(--accent);
        }

        /* Enhanced Account Cards */
        .account-card {
            transition: all 0.2s ease;
            border-radius: var(--radius);
        }

        .account-card:hover {
            background: var(--accent);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .account-card.active {
            background: var(--background);
            color: var(--foreground);
            box-shadow: var(--shadow-md);
            border: 2px solid var(--border);
        }

        .account-card.active:hover {
            background: var(--background);
        }

        /* Enhanced Knowledge Pills Layout */
        .knowledge-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: var(--muted/30);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        /* Enhanced Message Input Areas */
        .chat-input-area {
            background: var(--background);
            border-top: 1px solid var(--border);
            backdrop-filter: blur(8px);
        }

        /* Enhanced Copilot Messages */
        .copilot-message {
            background: var(--muted/30);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 0.75rem;
            line-height: 1.6;
            transition: all 0.2s ease;
        }

        .copilot-message:hover {
            background: var(--muted/40);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .copilot-message p {
            margin: 0;
        }

        .copilot-message h3, .copilot-message h4 {
            margin: 0 0 0.5rem 0;
        }

        /* Enhanced User Query Styling */
        .user-query {
            background: var(--primary);
            color: var(--primary-foreground);
            border-radius: var(--radius);
            padding: 0.75rem;
            line-height: 1.6;
        }



        /* Enhanced Focus Management */
        .focus-trap {
            outline: none;
        }

        .focus-trap:focus-within {
            box-shadow: 0 0 0 2px var(--ring);
            border-radius: var(--radius);
        }

        /* Enhanced Error States */
        .error-state {
            color: var(--destructive);
            border-color: var(--destructive);
        }

        .success-state {
            color: var(--success);
            border-color: var(--success);
        }

        /* Enhanced Loading Skeleton */
        .skeleton {
            background: linear-gradient(90deg, var(--muted) 25%, var(--muted/50) 50%, var(--muted) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Enhanced Account Cards - Subtle Interactions */
        .account-card {
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            transition: all 0.15s ease-out;
            cursor: pointer;
        }

        .account-card:hover {
            background: var(--accent);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .account-card:active {
            transform: translateY(0);
            transition: all 0.1s ease-out;
        }

        .account-card.active {
            background: var(--background);
            color: var(--foreground);
            box-shadow: var(--shadow-md);
            border: 2px solid var(--border);
            transform: none;
        }

        .account-card.active:hover {
            background: var(--background);
            transform: none;
        }

        .account-card.active:active {
            transform: none;
        }

        /* Enhanced Interactive Cards - Consistent Motion */
        .interactive-card {
            transition: all 0.15s ease-out;
            cursor: pointer;
        }

        .interactive-card:hover {
            background: var(--accent);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .interactive-card:active {
            transform: translateY(0);
            transition: all 0.1s ease-out;
        }

        /* Enhanced Card Interactions - Refined */
        .card {
            transition: all 0.15s ease-out;
            border-radius: var(--radius);
            overflow: hidden;
        }

        .card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }

        .card:active {
            transform: translateY(0);
            transition: all 0.1s ease-out;
        }

        /* Enhanced Button States - Consistent Motion */
        .btn {
            transition: all 0.15s ease-out;
            font-weight: 500;
            letter-spacing: 0.025em;
            border: none;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn:active {
            transform: translateY(0);
            transition: all 0.1s ease-out;
        }

        /* Enhanced Message Interactions */
        .customer-message, .advocate-message {
            transition: all 0.15s ease-out;
            border-radius: var(--radius);
            padding: 0.75rem;
        }

        .customer-message:hover,
        .advocate-message:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .customer-message:active,
        .advocate-message:active {
            transform: translateY(0);
            transition: all 0.1s ease-out;
        }

        /* Enhanced Button Styles - Tertiary/Link Style */
        .btn-tertiary {
            background: transparent;
            border: none;
            color: var(--muted-foreground);
            padding: 0.5rem 0.75rem;
            font-weight: 500;
            transition: all 0.15s ease-out;
            text-decoration: none;
        }

        .btn-tertiary:hover {
            background: var(--accent);
            color: var(--foreground);
            transform: translateY(-1px);
            box-shadow: none;
        }

        .btn-tertiary:active {
            transform: translateY(0);
            transition: all 0.1s ease-out;
        }

        /* Remove all button borders and strokes */
        .btn, .btn-outline, .btn-primary, .btn-secondary, .btn-ghost, .btn-tertiary {
            border: none !important;
            outline: none !important;
            box-shadow: none !important;
        }

        .btn:focus, .btn-outline:focus, .btn-primary:focus, .btn-secondary:focus, .btn-ghost:focus, .btn-tertiary:focus {
            border: none !important;
            outline: none !important;
            box-shadow: none !important;
        }

        /* Final UX/UI Polish - SLT Ready */
        
        /* Remove any remaining borders and outlines */
        button, input, textarea, select {
            border: none !important;
            outline: none !important;
        }
        
        button:focus, input:focus, textarea:focus, select:focus {
            border: none !important;
            outline: none !important;
            box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1) !important;
        }
        
        /* Ensure consistent typography */
        .card-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--card-foreground);
            margin: 0;
            letter-spacing: -0.025em;
        }
        
        .card-description {
            font-size: 0.75rem;
            color: var(--muted-foreground);
            margin: 0.25rem 0 0 0;
            line-height: 1.4;
        }
        
        /* Professional interaction states */
        .interactive-card, .account-card, .btn, .knowledge-pill, .reply-pill, .action-pill {
            transition: all 0.15s ease-out;
        }
        
        .interactive-card:hover, .account-card:hover, .knowledge-pill:hover, .reply-pill:hover, .action-pill:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .interactive-card:active, .account-card:active, .knowledge-pill:active, .reply-pill:active, .action-pill:active {
            transform: translateY(0);
            transition: all 0.1s ease-out;
        }
        
        /* Consistent spacing and alignment */
        .space-y-4 > * + * {
            margin-top: 1rem;
        }
        
        .space-y-3 > * + * {
            margin-top: 0.75rem;
        }
        
        .space-y-2 > * + * {
            margin-top: 0.5rem;
        }
        
        /* Professional status indicators */
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            animation: pulse 2s infinite;
        }
        
        /* Enhanced badge consistency */
        .badge {
            display: inline-flex;
            align-items: center;
            border-radius: calc(var(--radius) - 2px);
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 500;
            line-height: 1;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        
        /* Perfect message alignment */
        .message-bubble {
            max-width: 85%;
            word-wrap: break-word;
        }
        
        /* Consistent form elements */
        .input, .textarea {
            width: 100%;
            border-radius: calc(var(--radius) - 2px);
            border: 1px solid var(--input) !important;
            background: var(--background);
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            transition: all 0.2s;
            font-family: inherit;
        }
        
        .input:focus, .textarea:focus {
            border-color: var(--ring) !important;
            box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1) !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="grid-layout">
            <!-- Left Column: P0 Customer Info & Case Summary -->
            <div class="left-panel space-y-4 overflow-y-auto custom-scrollbar">
                <!-- P0 Customer Info Module -->
                <div class="card interactive-card" data-module="customer-info">
                    <div class="card-header">
                        <div class="flex items-center gap-2">
                            <i data-lucide="user" class="w-4 h-4"></i>
                            <h3 class="card-title">Customer Information</h3>
                            <span class="badge badge-p0">P0</span>
                        </div>
                        <p class="card-description">Universal context module</p>
                    </div>
                    <div class="card-content space-y-4">
                        <!-- Basic Customer Information -->
                        <div class="space-y-3">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 avatar rounded-full flex items-center justify-center text-white font-medium">
                                    SJ
                                </div>
                                <div>
                                    <p class="text-sm font-medium">Samuel L. Jackson</p>
                                    <p class="text-xs text-muted-foreground">Legal Name</p>
                                </div>
                            </div>
                            
                            <!-- Customer Labels -->
                            <div class="customer-labels">
                                <span class="badge badge-outline text-green-600">
                                    <i data-lucide="shield-check" class="w-3 h-3 mr-1"></i>
                                    Verified US
                                </span>
                                <span class="badge badge-outline text-blue-600">
                                    <i data-lucide="check-circle" class="w-3 h-3 mr-1"></i>
                                    Clean Risk
                                </span>
                                <span class="badge badge-outline text-purple-600">
                                    <i data-lucide="star" class="w-3 h-3 mr-1"></i>
                                    Premium
                                </span>
                            </div>
                        </div>
                        
                        <!-- Account Navigation -->
                        <div class="border-t pt-3">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="text-sm font-medium">Accounts (3 total)</h4>
                                <span class="text-xs text-muted-foreground">2 with BTC</span>
                            </div>
                            
                            <!-- Personal Account -->
                            <div class="account-card active" onclick="switchToAccount('personal')" data-account="personal">
                                <div class="account-header">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm font-medium">Personal Account</p>
                                            <p class="text-xs text-muted-foreground">$samuelj</p>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-sm btc-balance">0.00234 BTC</p>
                                            <p class="text-xs text-muted-foreground">~$156</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="account-labels">
                                    <span class="badge badge-outline text-blue-600">EIDV</span>
                                    <span class="badge badge-outline text-green-600">Verified</span>
                                </div>
                            </div>
                            
                            <!-- Business Account -->
                            <div class="account-card" onclick="switchToAccount('business')" data-account="business">
                                <div class="account-header">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm font-medium">Business Account</p>
                                            <p class="text-xs text-muted-foreground">$samuelj-biz</p>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-sm btc-balance">0.15678 BTC</p>
                                            <p class="text-xs text-muted-foreground">~$10,442</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="account-labels">
                                    <span class="badge badge-outline text-blue-600">Business Verified</span>
                                    <span class="badge badge-outline text-green-600">Tax Compliant</span>
                                </div>
                            </div>
                            
                            <!-- Savings Account (No BTC) -->
                            <div class="account-card opacity-60" onclick="switchToAccount('savings')" data-account="savings">
                                <div class="account-header">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-sm font-medium">Savings Account</p>
                                            <p class="text-xs text-muted-foreground">$samuelj-save</p>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-sm text-muted-foreground/60">No BTC</p>
                                            <p class="text-xs text-muted-foreground/60">$5,240 USD</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="account-labels">
                                    <span class="badge badge-outline text-muted-foreground/60">USD Only</span>
                                </div>
                            </div>
                            
                            <!-- Account Actions -->
                            <div class="flex gap-2 mt-3 pt-3 border-t" id="account-actions">
                                <button class="btn btn-tertiary btn-sm flex-1 focus-visible" onclick="askCopilot('Show me regulatory information for Samuel L. Jackson personal account')">
                                    <i data-lucide="external-link" class="w-3 h-3 mr-1"></i>
                                    Regulator
                                </button>
                                <button class="btn btn-tertiary btn-sm flex-1 focus-visible" onclick="askCopilot('Open advocate toolbox for Samuel L. Jackson personal account')">
                                    <i data-lucide="wrench" class="w-3 h-3 mr-1"></i>
                                    Toolbox
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- P0 Case Summary Module (Collapsible) -->
                <div class="card" data-module="case-summary">
                    <div class="card-header cursor-pointer" onclick="toggleModule('case-summary')">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <i data-lucide="file-text" class="w-4 h-4 text-muted-foreground"></i>
                                <h3 class="card-title">Case Summary</h3>
                                <span class="badge badge-outline text-xs font-mono">CS-2025-001234</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="badge badge-secondary">High</span>
                                <i data-lucide="chevron-down" class="w-4 h-4 text-muted-foreground" id="case-summary-chevron"></i>
                            </div>
                        </div>
                        <p class="card-description">Bitcoin withdrawal stuck - Transaction acceleration needed</p>
                    </div>
                    <div class="card-content space-y-3" id="case-summary-content" style="display: none;">
                        <div class="space-y-2">
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium">Subject</span>
                                <span class="text-sm text-muted-foreground">Transaction Stuck</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium">Priority</span>
                                <span class="badge badge-secondary">High</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium">Status</span>
                                <div class="flex items-center gap-2">
                                    <span class="status-indicator status-open"></span>
                                    <span class="badge badge-secondary">Open</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium">Case #</span>
                                <span class="text-sm text-muted-foreground font-mono">CS-2025-001234</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium">Group</span>
                                <span class="text-sm text-muted-foreground">Bitcoin Support</span>
                            </div>
                        </div>
                        <div class="p-3 bg-muted rounded-lg border border-border">
                            <div class="flex items-start gap-2">
                                <i data-lucide="alert-triangle" class="w-4 h-4 text-destructive mt-0.5 flex-shrink-0"></i>
                                <div>
                                    <h4 class="text-sm font-semibold mb-1 text-foreground">Key Problem Identified</h4>
                                    <p class="text-sm text-muted-foreground leading-relaxed">Bitcoin withdrawal stuck in mempool due to insufficient network fees (12 sat/vB when recommended is 45 sat/vB)</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Previous Cases -->
                <div class="card" data-module="previous-cases">
                    <div class="card-header cursor-pointer" onclick="toggleModule('previous-cases')">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <i data-lucide="folder" class="w-4 h-4 text-muted-foreground"></i>
                                <h3 class="card-title">Previous Cases</h3>
                                <span class="badge badge-outline">2</span>
                            </div>
                            <i data-lucide="chevron-down" class="w-4 h-4 text-muted-foreground" id="previous-cases-chevron"></i>
                        </div>
                        <p class="card-description">Related customer issues</p>
                    </div>
                    <div class="card-content space-y-2" id="previous-cases-content" style="display: none;">
                        <div class="interactive-card p-3 bg-muted/50 rounded-lg cursor-pointer" onclick="askCopilot('Tell me more about case CS-2025-001201 and how it was resolved')">
                            <div class="flex items-center justify-between">
                                <div class="space-y-1">
                                    <p class="text-xs font-medium font-mono">CS-2025-001201</p>
                                    <p class="text-xs text-muted-foreground">Bitcoin withdrawal low fee stuck</p>
                                </div>
                                <div class="text-right">
                                    <span class="badge badge-outline text-green-600">Resolved</span>
                                    <p class="text-xs text-muted-foreground mt-1">4 hours</p>
                                </div>
                            </div>
                        </div>
                        <div class="interactive-card p-3 bg-muted/50 rounded-lg cursor-pointer" onclick="askCopilot('Tell me more about case CS-2025-001156 and the network congestion solution')">
                            <div class="flex items-center justify-between">
                                <div class="space-y-1">
                                    <p class="text-xs font-medium font-mono">CS-2025-001156</p>
                                    <p class="text-xs text-muted-foreground">Bitcoin network congestion delay</p>
                                </div>
                                <div class="text-right">
                                    <span class="badge badge-outline text-green-600">Resolved</span>
                                    <p class="text-xs text-muted-foreground mt-1">6 hours</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Previous Transactions -->
                <div class="card" data-module="previous-transactions">
                    <div class="card-header cursor-pointer" onclick="toggleModule('previous-transactions')">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <i data-lucide="history" class="w-4 h-4 text-muted-foreground"></i>
                                <h3 class="card-title">Previous Transactions</h3>
                                <span class="badge badge-outline">2</span>
                            </div>
                            <i data-lucide="chevron-down" class="w-4 h-4 text-muted-foreground" id="previous-transactions-chevron"></i>
                        </div>
                        <p class="card-description">Related BTC transactions</p>
                    </div>
                    <div class="card-content space-y-2" id="previous-transactions-content" style="display: none;">
                        <div class="interactive-card p-3 bg-muted/50 rounded-lg cursor-pointer" onclick="askCopilot('Tell me more about transaction TX-BTC-789123 and why it is stuck in mempool')">
                            <div class="flex items-center justify-between">
                                <div class="space-y-1">
                                    <p class="text-xs font-medium font-mono">TX-BTC-789123</p>
                                    <p class="text-sm btc-balance">0.00234 BTC</p>
                                    <p class="text-xs text-muted-foreground">12 sat/vB  0 confirmations</p>
                                </div>
                                <div class="text-right">
                                    <span class="badge badge-outline text-yellow-600">Mempool</span>
                                    <p class="text-xs text-muted-foreground mt-1">3h 24m ago</p>
                                </div>
                            </div>
                        </div>
                        <div class="interactive-card p-3 bg-muted/50 rounded-lg cursor-pointer" onclick="askCopilot('Show me details about transaction TX-BTC-789124 and its confirmation process')">
                            <div class="flex items-center justify-between">
                                <div class="space-y-1">
                                    <p class="text-xs font-medium font-mono">TX-BTC-789124</p>
                                    <p class="text-sm btc-balance">0.00156 BTC</p>
                                    <p class="text-xs text-muted-foreground">45 sat/vB  3 confirmations</p>
                                </div>
                                <div class="text-right">
                                    <span class="badge badge-outline text-green-600">Confirmed</span>
                                    <p class="text-xs text-muted-foreground mt-1">2h 15m ago</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Center Column: P0 Conversation Panel -->
            <div class="middle-panel card panel-sync" data-module="conversation-panel">
                <div class="card-header">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <i data-lucide="message-circle" class="w-4 h-4"></i>
                            <h3 class="card-title">Conversation Panel</h3>
                            <span class="badge badge-p0">P0</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                            <span class="text-xs text-muted-foreground">Samuel L. - Online</span>
                        </div>
                    </div>
                    <p class="card-description">Real-time messaging channel</p>
                </div>
                
                <div class="flex-1 flex flex-col">
                    <!-- Messages Area -->
                    <div class="messages-container custom-scrollbar" id="messages-container">
                        <div class="space-y-4">
                            <!-- Customer Message -->
                            <div class="flex justify-start">
                                <div class="message-bubble">
                                    <div class="customer-message-wrapper">
                                        <div class="customer-message">
                                            <p class="text-sm">My Bitcoin withdrawal to bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh is still pending. What's going on?</p>
                                        </div>
                                        <div class="help-trigger" data-message="My Bitcoin withdrawal to bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh is still pending. What's going on?" onclick="askForHelp(this.dataset.message)" title="Get help responding to this message">
                                            <i data-lucide="help-circle" class="w-3 h-3 text-gray-500"></i>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2 mt-1">
                                        <span class="text-xs text-muted-foreground">2:30 PM</span>
                                        <span class="text-xs text-muted-foreground/60"></span>
                                        <span class="text-xs text-muted-foreground/60">Delivered</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Advocate Message -->
                            <div class="flex justify-end">
                                <div class="message-bubble">
                                    <div class="advocate-message">
                                        <p class="text-sm">Hi Samuel! I can see your Bitcoin withdrawal of 0.00234 BTC is stuck in the mempool. The network fee was set too low at 12 sat/vB when the current recommended fee is 45 sat/vB. Let me help you resolve this.</p>
                                    </div>
                                    <div class="flex items-center gap-2 mt-1 justify-end">
                                        <span class="text-xs text-muted-foreground/60">Read</span>
                                        <span class="text-xs text-muted-foreground/60"></span>
                                        <span class="text-xs text-muted-foreground">2:32 PM</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Customer Message with Reply Suggestions -->
                            <div class="flex justify-start">
                                <div class="message-bubble">
                                    <div class="customer-message-wrapper">
                                        <div class="customer-message">
                                            <p class="text-sm">It's been over 3 hours now. Can you accelerate the transaction or cancel it so I can resend with higher fees?</p>
                                        </div>
                                        <div class="help-trigger" data-message="It's been over 3 hours now. Can you accelerate the transaction or cancel it so I can resend with higher fees?" onclick="askForHelp(this.dataset.message)" title="Get help responding to this message">
                                            <i data-lucide="help-circle" class="w-3 h-3 text-gray-500"></i>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2 mt-1">
                                        <span class="text-xs text-muted-foreground">2:35 PM</span>
                                        <span class="text-xs text-muted-foreground/60"></span>
                                        <span class="text-xs text-muted-foreground/60">Delivered</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Reply Suggestions - Initially Hidden -->
                            <div class="reply-suggestions" id="reply-suggestions" style="display: none;">
                                <div class="text-xs font-medium text-muted-foreground w-full mb-2"> Suggested Replies:</div>
                                <div class="reply-pill" data-reply="Yes, I can help accelerate your transaction using CPFP. This will cost an additional $8-12 in fees but should confirm within 30 minutes. Would you like me to set this up?" onclick="useReplyPill(this.dataset.reply)">
                                    <i data-lucide="zap" class="w-3 h-3"></i>
                                    Offer CPFP acceleration
                                </div>
                                <div class="reply-pill" data-reply="I cannot cancel the transaction once it's broadcast, but I can help accelerate it. The other option is to wait 6-12 hours for natural confirmation during quieter network periods." onclick="useReplyPill(this.dataset.reply)">
                                    <i data-lucide="clock" class="w-3 h-3"></i>
                                    Explain cancellation limitations
                                </div>
                                <div class="reply-pill" data-reply="Let me check the current mempool status and give you precise timing estimates for both acceleration and natural confirmation options." onclick="useReplyPill(this.dataset.reply)">
                                    <i data-lucide="search" class="w-3 h-3"></i>
                                    Check mempool status
                                </div>
                            </div>
                            
                            <!-- Typing Indicator -->
                            <div class="flex justify-start" id="typing-indicator" style="display: none;">
                                <div class="typing-indicator">
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                    <div class="typing-dot"></div>
                                    <span class="text-xs text-muted-foreground ml-2">Samuel is typing...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Message Input -->
                    <div class="chat-input-area">
                        <div class="flex gap-3 items-end">
                            <div class="flex-1">
                                <textarea 
                                    class="textarea resize-none focus-visible"
                                    placeholder="Type your message..."
                                    rows="2"
                                    id="message-input"
                                    onkeydown="handleKeyDown(event)"
                                ></textarea>
                            </div>
                            <button class="btn btn-primary focus-visible" onclick="sendMessage()" id="send-button">
                                <i data-lucide="send" class="w-4 h-4"></i>
                            </button>
                        </div>
                        <div class="flex items-center justify-between mt-2">
                            <div class="flex items-center gap-2">
                                <button class="btn btn-ghost btn-sm" onclick="attachFile()">
                                    <i data-lucide="paperclip" class="w-4 h-4"></i>
                                </button>
                                <button class="btn btn-ghost btn-sm" onclick="addEmoji()">
                                    <i data-lucide="smile" class="w-4 h-4"></i>
                                </button>
                            </div>
                            <span class="text-xs text-muted-foreground/60" id="char-count">0/1000</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Enhanced P0 Support Copilot -->
            <div class="right-panel card panel-sync" data-module="support-copilot">
                <div class="card-header">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <i data-lucide="sparkles" class="w-4 h-4 text-purple-500"></i>
                            <h3 class="card-title">Support Copilot</h3>
                            <span class="badge badge-p0">P0</span>
                        </div>
                        <button class="btn btn-ghost btn-sm" onclick="toggleCopilot()">
                            <i data-lucide="minimize-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <p class="card-description">AI-powered Bitcoin support assistant</p>
                </div>
                
                <div class="flex flex-col h-full">
                    <!-- Enhanced Segment Control -->
                    <div class="px-4 pt-4">
                        <!-- Segment Control moved above case summary -->
                        <div class="segment-control">
                            <button class="segment-button active" onclick="switchTab('copilot')" id="tab-copilot">
                                <i data-lucide="bot" class="w-4 h-4"></i>
                                Copilot
                            </button>
                            <button class="segment-button" onclick="switchTab('tools')" id="tab-tools">
                                <i data-lucide="tool" class="w-4 h-4"></i>
                                Tools
                            </button>
                            <button class="segment-button" onclick="switchTab('bitcoin')" id="tab-bitcoin">
                                <i data-lucide="bitcoin" class="w-4 h-4"></i>
                                Bitcoin
                            </button>
                        </div>

                        <!-- Case Summary Pill -->
                        <div class="case-summary-pill expanded" onclick="toggleCaseSummary()" id="case-summary-pill">
                            <div class="flex items-center gap-2">
                                <i data-lucide="file-text" class="w-4 h-4"></i>
                                <span>Case Summary: CS-2025-001234</span>
                            </div>
                            <i data-lucide="chevron-up" class="w-4 h-4" id="case-summary-icon"></i>
                        </div>
                        
                        <!-- Case Summary Content -->
                        <div class="case-summary-content expanded" id="case-summary-content">
                            <div class="space-y-3">
                                <div class="text-sm text-muted-foreground">
                                    <strong class="text-foreground">Bitcoin Withdrawal Stuck in Mempool</strong><br>
                                    Customer Samuel L. Jackson's 0.00234 BTC withdrawal has been pending for 3+ hours due to insufficient network fees (12 sat/vB vs recommended 45 sat/vB).
                                </div>
                                
                                <div class="grid grid-cols-2 gap-3 text-xs">
                                    <div>
                                        <span class="font-medium text-muted-foreground">Case #:</span>
                                        <span class="text-foreground">CS-2025-001234</span>
                                    </div>
                                    <div>
                                        <span class="font-medium text-muted-foreground">Owner:</span>
                                        <span class="text-foreground">Alex Chen</span>
                                    </div>
                                    <div>
                                        <span class="font-medium text-muted-foreground">Current Group:</span>
                                        <span class="text-foreground">Bitcoin Support</span>
                                    </div>
                                    <div>
                                        <span class="font-medium text-muted-foreground">Subject:</span>
                                        <span class="text-foreground">Transaction Stuck</span>
                                    </div>
                                </div>
                                
                                <div class="text-xs text-muted-foreground pt-2 border-t">
                                    <strong class="text-foreground">Priority:</strong> High  <strong class="text-foreground">Status:</strong> Open  <strong class="text-foreground">Duration:</strong> 3h 24m
                                </div>
                                
                                <!-- Tools Actions -->
                                <div class="flex gap-2 pt-3 border-t">
                                    <button class="btn btn-tertiary btn-sm flex-1" onclick="askCopilot('Open transaction accelerator tool for case CS-2025-001234')">
                                        <i data-lucide="zap" class="w-3 h-3 mr-1"></i>
                                        Accelerator
                                    </button>
                                    <button class="btn btn-tertiary btn-sm flex-1" onclick="askCopilot('Open mempool analyzer for stuck transaction')">
                                        <i data-lucide="activity" class="w-3 h-3 mr-1"></i>
                                        Mempool
                                    </button>
                                    <button class="btn btn-tertiary btn-sm flex-1" onclick="askCopilot('Open fee estimator tool for Bitcoin network')">
                                        <i data-lucide="calculator" class="w-3 h-3 mr-1"></i>
                                        Fee Calc
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Copilot Chat Area -->
                    <div id="copilot-tab" class="flex-1 flex flex-col">
                        <!-- Knowledge Base -->
                        <div class="px-4 pb-4">
                            <div class="flex items-center justify-between mb-2 cursor-pointer" onclick="toggleKnowledgeBase()">
                                <h4 class="text-xs font-semibold text-muted-foreground mb-0 uppercase tracking-wide">Knowledge Base</h4>
                                <i data-lucide="chevron-down" class="w-4 h-4 text-muted-foreground" id="knowledge-base-chevron"></i>
                            </div>
                            <div class="knowledge-pills" id="knowledge-pills-container" style="display: none;">
                                <div class="knowledge-pill" onclick="askKnowledge('Bitcoin transaction stuck in mempool')">
                                    <i data-lucide="help-circle" class="w-3 h-3"></i>
                                    Stuck Transactions
                                </div>
                                <div class="knowledge-pill" onclick="askKnowledge('Bitcoin network fees and CPFP acceleration')">
                                    <i data-lucide="zap" class="w-3 h-3"></i>
                                    Fee Acceleration
                                </div>
                                <div class="knowledge-pill" onclick="askKnowledge('Bitcoin mempool congestion customer communication')">
                                    <i data-lucide="message-square" class="w-3 h-3"></i>
                                    Customer Communication
                                </div>
                                <div class="knowledge-pill" onclick="askKnowledge('Bitcoin RBF replace by fee process')">
                                    <i data-lucide="refresh-cw" class="w-3 h-3"></i>
                                    RBF Process
                                </div>
                            </div>
                        </div>

                        <!-- Chat Messages -->
                        <div class="copilot-messages-container custom-scrollbar" id="copilot-messages">
                            <div class="space-y-4">
                                <!-- Initial Case Analysis -->
                                <div class="flex justify-start" id="initial-analysis" style="display: none;">
                                    <div class="message-bubble">
                                        <div class="copilot-message">
                                            <p class="text-sm"> <strong>Case Analysis Complete</strong></p>
                                            <p class="text-sm mt-2">I've analyzed case CS-2025-001234. The customer's Bitcoin withdrawal is stuck due to insufficient network fees. The transaction used 12 sat/vB when the current recommended rate is 45 sat/vB.</p>
                                            <p class="text-sm mt-2"><strong>Key Issues:</strong></p>
                                            <ul class="text-sm mt-1 ml-4 list-disc">
                                                <li>Transaction stuck in mempool for 3+ hours</li>
                                                <li>Network congestion causing delays</li>
                                                <li>Customer likely frustrated with wait time</li>
                                            </ul>
                                            <p class="text-sm mt-3"><strong>Recommended Strategy:</strong> Explain the situation clearly and offer acceleration options.</p>
                                            
                                            <div class="action-suggestions">
                                                <div class="action-pill" onclick="acceptAction('Explain mempool congestion', 'Hi Samuel! I can see your Bitcoin withdrawal is taking longer than expected. The Bitcoin network is currently experiencing high congestion, which means transactions with lower fees take longer to confirm. Your transaction used 12 sat/vB, but the current recommended rate is 45 sat/vB due to network demand.')">
                                                    <i data-lucide="arrow-right" class="w-3 h-3"></i>
                                                    Explain mempool congestion
                                                </div>
                                                <div class="action-pill" onclick="acceptAction('Offer CPFP acceleration', 'I can help accelerate your transaction using CPFP (Child Pays for Parent). This creates a new transaction with higher fees that will help confirm both transactions faster. The additional cost would be approximately $8-12 USD. Would you like me to guide you through this process?')">
                                                    <i data-lucide="arrow-right" class="w-3 h-3"></i>
                                                    Offer CPFP acceleration
                                                </div>
                                                <div class="action-pill" onclick="acceptAction('Provide realistic timeline', 'Based on current network conditions, your transaction should confirm within 6-12 hours during low network activity periods (typically late night/early morning UTC). I can monitor it for you and provide updates as the situation changes.')">
                                                    <i data-lucide="arrow-right" class="w-3 h-3"></i>
                                                    Provide realistic timeline
                                                </div>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-2 mt-1">
                                            <i data-lucide="bot" class="w-3 h-3 text-muted-foreground"></i>
                                            <span class="text-xs text-muted-foreground">Support Copilot</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Typing Indicator for Copilot -->
                                <div class="flex justify-start" id="copilot-typing-indicator" style="display: none;">
                                    <div class="typing-indicator">
                                        <div class="typing-dot"></div>
                                        <div class="typing-dot"></div>
                                        <div class="typing-dot"></div>
                                        <span class="text-xs text-muted-foreground ml-2">Copilot is thinking...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Copilot Input -->
                        <div class="p-4 border-t border-border bg-muted/50">
                            <div class="flex gap-3 items-end">
                                <div class="flex-1">
                                    <textarea 
                                        class="textarea resize-none focus-visible"
                                        placeholder="Ask about Bitcoin transactions, fees, or mempool..."
                                        rows="2"
                                        id="copilot-input"
                                        onkeydown="handleCopilotKeyDown(event)"
                                    ></textarea>
                                </div>
                                <button class="btn btn-primary focus-visible" onclick="sendCopilotQuery()" id="copilot-send">
                                    <i data-lucide="arrow-up" class="w-4 h-4"></i>
                                </button>
                            </div>
                            <div class="flex items-center justify-between mt-2">
                                <div class="flex items-center gap-2">
                                    <button class="btn btn-ghost btn-sm" onclick="clearCopilotChat()">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                    <button class="btn btn-ghost btn-sm" onclick="exportCopilotChat()">
                                        <i data-lucide="download" class="w-4 h-4"></i>
                                    </button>
                                </div>
                                <span class="text-xs text-muted-foreground/60" id="copilot-char-count">0/1000</span>
                            </div>
                        </div>
                    </div>

                    <!-- Universal Tools Tab -->
                    <div id="tools-tab" class="flex-1 p-4 space-y-3" style="display: none;">
                        <h4 class="text-sm font-medium mb-3">Universal Agentic Tools</h4>
                        <button class="btn btn-outline w-full justify-start interactive-card" onclick="askCopilot('Help me transfer this case to another department or specialist')">
                            <i data-lucide="arrow-right-left" class="w-4 h-4 mr-2"></i>
                            Transfer Case
                        </button>
                        <button class="btn btn-outline w-full justify-start interactive-card" onclick="askCopilot('Help me file a complaint for this customer issue')">
                            <i data-lucide="flag" class="w-4 h-4 mr-2"></i>
                            File Complaint
                        </button>
                        <button class="btn btn-outline w-full justify-start interactive-card" onclick="askCopilot('Search the knowledge base for solutions to this Bitcoin issue')">
                            <i data-lucide="search" class="w-4 h-4 mr-2"></i>
                            Knowledge Search
                        </button>
                    </div>

                    <!-- Bitcoin Tools Tab -->
                    <div id="bitcoin-tab" class="flex-1 p-4 space-y-3" style="display: none;">
                        <h4 class="text-sm font-medium mb-3">Bitcoin-Specific Tools</h4>
                        <div class="interactive-card p-3 bg-orange-50 rounded-lg cursor-pointer" onclick="askCopilot('Check the mempool status for transaction TX-BTC-789123 and show me its position in the queue')">
                            <div class="flex items-center gap-2 mb-1">
                                <i data-lucide="search" class="w-4 h-4 text-orange-500"></i>
                                <h4 class="text-sm font-medium">Mempool Explorer</h4>
                            </div>
                            <p class="text-xs text-muted-foreground">Check transaction status and mempool position</p>
                        </div>
                        <div class="interactive-card p-3 bg-blue-50 rounded-lg cursor-pointer" onclick="askCopilot('Help me accelerate the stuck Bitcoin transaction using CPFP or RBF methods')">
                            <div class="flex items-center gap-2 mb-1">
                                <i data-lucide="zap" class="w-4 h-4 text-blue-500"></i>
                                <h4 class="text-sm font-medium">Fee Accelerator</h4>
                            </div>
                            <p class="text-xs text-muted-foreground">CPFP or RBF transaction acceleration</p>
                        </div>
                        <div class="interactive-card p-3 bg-green-50 rounded-lg cursor-pointer" onclick="askCopilot('Show me current Bitcoin network fees and recommend optimal fee rates')">
                            <div class="flex items-center gap-2 mb-1">
                                <i data-lucide="calculator" class="w-4 h-4 text-green-500"></i>
                                <h4 class="text-sm font-medium">Fee Estimator</h4>
                            </div>
                            <p class="text-xs text-muted-foreground">Real-time Bitcoin network fee estimation</p>
                        </div>
                        <div class="interactive-card p-3 bg-purple-50 rounded-lg cursor-pointer" onclick="askCopilot('Search Bitcoin troubleshooting guides for stuck transaction solutions')">
                            <div class="flex items-center gap-2 mb-1">
                                <i data-lucide="book-open" class="w-4 h-4 text-purple-500"></i>
                                <h4 class="text-sm font-medium">Bitcoin KB</h4>
                            </div>
                            <p class="text-xs text-muted-foreground">Search Bitcoin troubleshooting guides</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container"></div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Global variables
        let currentTab = 'copilot';
        let copilotMessages = [];
        let conversationMessages = [];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Set up event listeners
            setupEventListeners();
            
            // Initialize character counters
            updateCharacterCount('message-input', 'char-count');
            updateCharacterCount('copilot-input', 'copilot-char-count');
            
            // Show initial case analysis after a short delay
            setTimeout(() => {
                showInitialCaseAnalysis();
            }, 1500);
            
            // Show typing indicator occasionally
            setTimeout(() => {
                showTypingIndicator();
            }, 8000);
        }

        function setupEventListeners() {
            // Message input character counter
            document.getElementById('message-input').addEventListener('input', function() {
                updateCharacterCount('message-input', 'char-count');
            });

            // Copilot input character counter
            document.getElementById('copilot-input').addEventListener('input', function() {
                updateCharacterCount('copilot-input', 'copilot-char-count');
            });

            // Account switching
            document.querySelectorAll('.account-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    switchAccount(this.dataset.account);
                });
            });

            // Add click animations to interactive cards
            document.querySelectorAll('.interactive-card').forEach(card => {
                card.addEventListener('click', function() {
                    this.classList.add('animate-click');
                    setTimeout(() => {
                        this.classList.remove('animate-click');
                    }, 200);
                });
            });
        }

        // Tab Management
        function switchTab(tabName) {
            // Update segment buttons
            document.querySelectorAll('.segment-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`tab-${tabName}`).classList.add('active');

            // Show/hide tab content
            document.querySelectorAll('[id$="-tab"]').forEach(tab => {
                tab.style.display = 'none';
            });
            document.getElementById(`${tabName}-tab`).style.display = tabName === 'copilot' ? 'flex' : 'block';

            currentTab = tabName;
        }

        // Copilot Functions
        function askCopilot(query) {
            // Switch to copilot tab if not already active
            if (currentTab !== 'copilot') {
                switchTab('copilot');
            }

            // Set the query in the input
            document.getElementById('copilot-input').value = query;
            
            // Send the query
            sendCopilotQuery();
        }

        function sendCopilotQuery() {
            const input = document.getElementById('copilot-input');
            const query = input.value.trim();
            
            if (!query) return;

            // Add user query to chat
            addCopilotMessage(query, 'user');
            
            // Clear input
            input.value = '';
            updateCharacterCount('copilot-input', 'copilot-char-count');
            
            // Show typing indicator
            showCopilotTyping();
            
            // Simulate AI response
            setTimeout(() => {
                hideCopilotTyping();
                generateCopilotResponse(query);
            }, 1500 + Math.random() * 1000);
        }

        function addCopilotMessage(message, type, suggestedActions = []) {
            const messagesContainer = document.getElementById('copilot-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex justify-start';
            
            const isUser = type === 'user';
            const messageClass = isUser ? 'user-query' : 'copilot-message';
            const icon = isUser ? 'user' : 'bot';
            const sender = isUser ? 'You' : 'Support Copilot';
            
            let actionsHTML = '';
            if (suggestedActions.length > 0) {
                actionsHTML = `
                    <div class="action-suggestions">
                        ${suggestedActions.map(action => `
                            <div class="action-pill" onclick="acceptAction('${action.text}', '${action.message.replace(/'/g, "\\'")}')">
                                <i data-lucide="arrow-right" class="w-3 h-3"></i>
                                ${action.text}
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            messageDiv.innerHTML = `
                <div class="message-bubble">
                    <div class="${messageClass}">
                        <p class="text-sm">${message}</p>
                        ${actionsHTML}
                    </div>
                    <div class="flex items-center gap-2 mt-1">
                        <i data-lucide="${icon}" class="w-3 h-3 ${isUser ? 'text-gray-500' : 'text-gray-500'}"></i>
                        <span class="text-xs text-gray-500">${sender}</span>
                    </div>
                </div>
            `;
            
            messagesContainer.querySelector('.space-y-4').appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Re-initialize icons
            lucide.createIcons();
        }

        function generateCopilotResponse(query) {
            let response = '';
            let suggestedActions = [];
            
            // Generate contextual responses based on query content
            if (query.toLowerCase().includes('transaction') && query.toLowerCase().includes('tx-btc-789123')) {
                response = `Transaction TX-BTC-789123 Analysis:
                
 **Status**: Stuck in mempool for 3h 24m
 **Amount**: 0.00234 BTC
 **Fee Rate**: 12 sat/vB (insufficient)
 **Recommended**: 45 sat/vB for next block
 **Position**: ~2,847 in mempool queue

**Recommended Actions**:
1. **CPFP (Child Pays for Parent)** - Create a new transaction spending from this one with higher fees
2. **RBF (Replace-by-Fee)** - If enabled, replace with higher fee transaction
3. **Wait** - May confirm in 6-12 hours during low network activity

**Analysis Complete** - Here are your next best actions:`;
                
                suggestedActions = [
                    {
                        text: "Explain CPFP to customer",
                        message: "I can help accelerate your transaction using CPFP (Child Pays for Parent). This creates a new transaction with higher fees that will help confirm both transactions faster. Would you like me to guide you through this process?"
                    },
                    {
                        text: "Check if RBF is enabled",
                        message: "Let me check if your transaction has RBF (Replace-by-Fee) enabled, which would allow us to replace it with a higher fee version."
                    },
                    {
                        text: "Provide wait time estimate",
                        message: "Based on current network conditions, your transaction may confirm in 6-12 hours during low network activity periods (typically late night/early morning UTC). I'll monitor it for you."
                    }
                ];
            } else if (query.toLowerCase().includes('mempool')) {
                response = `
                    <div class="space-y-3">
                        <div class="flex items-center gap-2 mb-3">
                            <i data-lucide="activity" class="w-4 h-4 text-muted-foreground"></i>
                            <h3 class="text-sm font-semibold">Current Bitcoin Mempool Status</h3>
                        </div>
                        
                        <div class="grid grid-cols-1 gap-3">
                            <div class="bg-muted/50 border border-border rounded-lg p-3">
                                <div class="flex items-center gap-2 mb-1">
                                    <div class="w-2 h-2 bg-destructive rounded-full"></div>
                                    <span class="text-sm font-medium text-foreground">Network Congestion</span>
                                </div>
                                <span class="text-xs text-muted-foreground">High</span>
                            </div>
                            
                            <div class="bg-muted/50 border border-border rounded-lg p-3">
                                <h4 class="text-sm font-medium text-foreground mb-2">Recommended Fees</h4>
                                <div class="space-y-1 text-xs text-muted-foreground">
                                    <div class="flex justify-between">
                                        <span>Next block:</span>
                                        <span class="font-medium text-foreground">45-50 sat/vB</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>30 minutes:</span>
                                        <span class="font-medium text-foreground">35-40 sat/vB</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>1 hour:</span>
                                        <span class="font-medium text-foreground">25-30 sat/vB</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-muted/50 border border-border rounded-lg p-3">
                                <h4 class="text-sm font-medium text-foreground mb-2">Network Stats</h4>
                                <div class="grid grid-cols-2 gap-2 text-xs text-muted-foreground">
                                    <div>
                                        <span class="text-muted-foreground">Mempool Size:</span>
                                        <div class="font-medium text-foreground">~180 MB</div>
                                    </div>
                                    <div>
                                        <span class="text-muted-foreground">Unconfirmed:</span>
                                        <div class="font-medium text-foreground">~85,000</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="border-t pt-3">
                            <div class="flex items-start gap-2">
                                <i data-lucide="info" class="w-4 h-4 text-muted-foreground mt-0.5 flex-shrink-0"></i>
                                <div>
                                    <p class="text-sm text-muted-foreground">
                                        <span class="font-medium text-foreground">Analysis:</span> The customer's transaction at 12 sat/vB is significantly below current rates. This is why it's stuck.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                suggestedActions = [
                    {
                        text: "Explain network congestion",
                        message: "The Bitcoin network is currently experiencing high congestion with over 85,000 unconfirmed transactions. This is causing delays for transactions with lower fees like yours."
                    },
                    {
                        text: "Recommend fee acceleration",
                        message: "I recommend increasing your transaction fee to 45-50 sat/vB to get confirmed in the next block, or 35-40 sat/vB for confirmation within 30 minutes."
                    }
                ];
            } else if (query.toLowerCase().includes('accelerate')) {
                response = `Bitcoin Transaction Acceleration Options:

**1. CPFP (Child Pays for Parent)**
- Create new transaction spending the stuck output
- Set higher fee rate (45+ sat/vB)
- Both transactions confirm together

**2. RBF (Replace-by-Fee)**
- Only if original transaction flagged RBF
- Replace with identical transaction + higher fees
- Cancels original transaction

**3. Fee Bumping Services**
- Third-party acceleration services
- Usually cost $5-20 depending on size
- Not always reliable

I recommend CPFP as the most reliable method. **Choose your next action**:`;
                
                suggestedActions = [
                    {
                        text: "Guide through CPFP process",
                        message: "I'll guide you through the CPFP (Child Pays for Parent) process step by step. This is the most reliable method to accelerate your stuck transaction."
                    },
                    {
                        text: "Check RBF compatibility",
                        message: "Let me check if your transaction is RBF-enabled so we can replace it with a higher fee version instead."
                    },
                    {
                        text: "Calculate acceleration cost",
                        message: "Based on current network fees, accelerating your transaction would cost approximately $8-12 USD in additional fees. Would you like to proceed?"
                    }
                ];
            } else if (query.toLowerCase().includes('case') || query.toLowerCase().includes('cs-2025')) {
                response = `Case Analysis Complete:

**Similar Cases Resolved**:
 CS-2025-001201: Bitcoin low fee issue - Resolved via CPFP in 4 hours
 CS-2025-001156: Network congestion delay - Customer waited 6 hours, transaction confirmed

**Resolution Strategy**:
1. Explain mempool congestion to customer
2. Offer CPFP acceleration option
3. Provide realistic timeline (6-12 hours if waiting)
4. Document resolution method for future reference

This follows our standard Bitcoin troubleshooting protocol. The customer seems frustrated but understanding.`;
            } else if (query.toLowerCase().includes('fee')) {
                response = `
                    <div class="space-y-3">
                        <div class="flex items-center gap-2 mb-3">
                            <i data-lucide="calculator" class="w-4 h-4 text-muted-foreground"></i>
                            <h3 class="text-sm font-semibold">Bitcoin Fee Analysis</h3>
                        </div>
                        
                        <div class="bg-muted/50 border border-border rounded-lg p-3">
                            <h4 class="text-sm font-medium text-foreground mb-2">Current Network Conditions</h4>
                            <div class="space-y-1 text-xs text-muted-foreground">
                                <div class="flex justify-between">
                                    <span>High Priority:</span>
                                    <span class="font-medium text-foreground">45-50 sat/vB (next block)</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Medium Priority:</span>
                                    <span class="font-medium text-foreground">30-35 sat/vB (30 min)</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Low Priority:</span>
                                    <span class="font-medium text-foreground">20-25 sat/vB (1-2 hours)</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-muted/50 border border-border rounded-lg p-3">
                            <h4 class="text-sm font-medium text-foreground mb-2">Customer's Transaction</h4>
                            <div class="space-y-1 text-xs text-muted-foreground">
                                <div class="flex justify-between">
                                    <span>Used:</span>
                                    <span class="font-medium text-foreground">12 sat/vB</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Shortage:</span>
                                    <span class="font-medium text-destructive">33 sat/vB below recommended</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Additional fee needed:</span>
                                    <span class="font-medium text-foreground">~$8-12 USD</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="border-t pt-3">
                            <div class="flex items-start gap-2">
                                <i data-lucide="lightbulb" class="w-4 h-4 text-muted-foreground mt-0.5 flex-shrink-0"></i>
                                <div>
                                    <p class="text-sm text-muted-foreground">
                                        <span class="font-medium text-foreground">Recommendation:</span> Educate customer about dynamic fee estimation and suggest using higher fee rates during peak times.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (query.toLowerCase().includes('regulatory') || query.toLowerCase().includes('regulator')) {
                response = `Customer Regulatory Information:

**Compliance Status**:  Fully Compliant
 EIDV Verified: Yes
 AML Status: Clean
 Risk Level: Low
 Jurisdiction: United States

**Transaction Limits**:
 Daily: $10,000 USD
 Monthly: $50,000 USD
 Current Usage: 2.3% of daily limit

**Required Actions**: None - customer is in good standing with all regulatory requirements.`;
            } else if (query.toLowerCase().includes('toolbox')) {
                response = `Advocate Toolbox Access:

**Available Tools**:
 Transaction Lookup & Analysis
 Fee Estimation Calculator  
 Mempool Position Checker
 CPFP/RBF Guidance Wizard
 Customer Communication Templates
 Escalation Procedures

**Quick Actions**:
 Generate case summary
 Create follow-up reminder
 Send transaction status update
 Schedule callback

All tools are pre-configured for Bitcoin support scenarios. Which tool would you like to use?`;
            } else if (query.toLowerCase().includes('tell me about:')) {
                // Knowledge article synthesis
                const topic = query.replace(/tell me about:\s*/i, '').trim();
                
                if (topic.toLowerCase().includes('stuck') || topic.toLowerCase().includes('mempool')) {
                    response = ` **Knowledge Article Synthesis: Bitcoin Transaction Stuck in Mempool**

**Root Causes:**
 Low network fees relative to current demand
 Network congestion during high-traffic periods
 Mempool size exceeding block processing capacity

**Technical Details:**
 Transactions are prioritized by fee rate (sat/vB)
 Miners select highest-paying transactions first
 Current network conditions require 45+ sat/vB for timely confirmation

**Customer Impact:**
 Frustration with unexpected delays
 Confusion about why transaction isn't confirming
 Concern about funds being lost (they're not)

**Best Practices for Communication:**
 Acknowledge the inconvenience upfront
 Explain the technical reason simply
 Offer concrete solutions with timelines
 Reassure about fund security

**Recommended next action for customer communication:**`;
                    
                    suggestedActions = [
                        {
                            text: "Send empathetic explanation",
                            message: "I understand how frustrating it can be when your Bitcoin withdrawal takes longer than expected. Your funds are completely safe - they're just waiting in the mempool (think of it as a waiting room) because the network is busy. Your transaction used a lower fee rate, so it's waiting for network traffic to decrease or you can choose to accelerate it."
                        },
                        {
                            text: "Offer technical solution",
                            message: "I can help speed up your transaction using a method called CPFP (Child Pays for Parent). This creates a second transaction with higher fees that helps confirm both transactions faster. The additional cost would be around $8-12, and it typically confirms within 30 minutes. Would you like me to set this up for you?"
                        },
                        {
                            text: "Provide reassurance + timeline",
                            message: "Your Bitcoin is completely secure and will definitely be processed - it's just a matter of timing. Based on current network conditions, your transaction should confirm naturally within 6-12 hours during quieter periods. I'm monitoring it for you and will update you if anything changes."
                        }
                    ];
                } else if (topic.toLowerCase().includes('acceleration') || topic.toLowerCase().includes('cpfp')) {
                    response = ` **Knowledge Article Synthesis: Bitcoin Fee Acceleration (CPFP)**

**What is CPFP?**
 Child Pays for Parent - a Bitcoin protocol feature
 Creates a new transaction that spends from the stuck transaction
 Both transactions get confirmed together when the child has sufficient fees

**How it Works:**
1. Identify the stuck transaction (parent)
2. Create a new transaction (child) spending from it
3. Set child transaction fee high enough to cover both
4. Miners process both transactions together

**Customer Benefits:**
 Faster confirmation (usually within 30 minutes)
 No risk to original transaction
 Controlled cost (customer chooses fee level)

**Communication Strategy:**
 Present as a premium service option
 Explain the additional cost upfront
 Emphasize speed and reliability
 Offer alternative of waiting

**Recommended customer communication:**`;
                    
                    suggestedActions = [
                        {
                            text: "Explain CPFP simply",
                            message: "I can offer you a fee acceleration service called CPFP. Think of it like paying extra to move to the front of the line. We create a second transaction with higher fees that helps confirm both your original transaction and the new one together. It's completely safe and usually confirms within 30 minutes."
                        },
                        {
                            text: "Present cost-benefit",
                            message: "The CPFP acceleration would cost an additional $8-12 in network fees, but it would get your transaction confirmed within 30 minutes instead of potentially waiting 6-12 hours. This is entirely optional - your transaction will eventually confirm on its own, but this gives you speed and certainty."
                        },
                        {
                            text: "Offer guided setup",
                            message: "If you'd like to proceed with CPFP acceleration, I can guide you through the process step by step. It takes about 5 minutes to set up, and I'll monitor both transactions to ensure they confirm successfully. Would you like me to walk you through it?"
                        }
                    ];
                } else if (topic.toLowerCase().includes('communication') || topic.toLowerCase().includes('customer')) {
                    response = ` **Knowledge Article Synthesis: Bitcoin Customer Communication Best Practices**

**Communication Principles:**
 Lead with empathy and understanding
 Use simple, non-technical language
 Provide clear next steps and timelines
 Always reassure about fund security

**Common Customer Concerns:**
 "Are my funds lost?" (No, they're safe)
 "Why is this taking so long?" (Network congestion)
 "What can I do about it?" (Wait or accelerate)
 "Will this happen again?" (Prevention tips)

**Effective Messaging Framework:**
1. **Acknowledge** - "I understand this is frustrating"
2. **Explain** - Simple reason for the delay
3. **Reassure** - Funds are completely safe
4. **Offer Solutions** - Wait or accelerate options
5. **Follow Up** - Commit to monitoring/updates

**Tone Guidelines:**
 Professional but warm
 Confident and knowledgeable
 Patient and understanding
 Solution-focused

**Recommended customer communication:**`;
                    
                    suggestedActions = [
                        {
                            text: "Empathetic opening",
                            message: "I completely understand your concern about the delayed Bitcoin withdrawal, and I want to assure you that your funds are completely safe. This delay is due to high network demand, not any issue with your account or our systems. Let me explain what's happening and how we can resolve this together."
                        },
                        {
                            text: "Educational approach",
                            message: "Bitcoin transactions work like a priority queue - transactions with higher fees get processed first during busy periods. Your transaction is safely waiting in the mempool with thousands of others. The good news is we have options to either wait for natural confirmation (6-12 hours) or accelerate it (30 minutes for $8-12 extra)."
                        },
                        {
                            text: "Solution-focused response",
                            message: "Here's what I can do for you right now: I can monitor your transaction and provide updates, help you accelerate it for faster confirmation, or simply wait it out since it will definitely confirm. Your Bitcoin is secure either way. What would you prefer to do?"
                        }
                    ];
                } else if (topic.toLowerCase().includes('rbf') || topic.toLowerCase().includes('replace')) {
                    response = ` **Knowledge Article Synthesis: Bitcoin RBF (Replace-by-Fee) Process**

**What is RBF?**
 Replace-by-Fee - Bitcoin protocol feature
 Allows replacing unconfirmed transactions with higher fees
 Must be enabled when creating the original transaction

**How RBF Works:**
1. Check if original transaction has RBF flag enabled
2. Create replacement transaction with identical outputs
3. Increase the fee to current network rates
4. Broadcast replacement (cancels original)

**RBF vs CPFP:**
 RBF replaces the original transaction
 CPFP creates a child transaction
 RBF requires original RBF flag
 CPFP works with any transaction

**Customer Communication:**
 Check RBF compatibility first
 Explain replacement vs acceleration
 Clarify that original transaction gets cancelled
 Emphasize same destination/amount

**Recommended customer communication:**`;
                    
                    suggestedActions = [
                        {
                            text: "Check RBF compatibility",
                            message: "Let me check if your transaction has RBF (Replace-by-Fee) enabled. This would allow us to replace your current transaction with an identical one that has higher fees, essentially canceling the slow one and creating a faster version. I'll analyze your transaction details now."
                        },
                        {
                            text: "Explain RBF process",
                            message: "Good news! Your transaction supports RBF. This means I can replace your current slow transaction with a faster version that has higher fees. The new transaction will send the same amount to the same address, but with fees that will get it confirmed quickly. The original transaction will be cancelled automatically."
                        },
                        {
                            text: "RBF not available alternative",
                            message: "I've checked your transaction and it doesn't have RBF enabled, which means we can't replace it directly. However, I can still help you with CPFP acceleration, which creates a child transaction that speeds up both transactions together. This is actually more reliable than RBF in most cases."
                        }
                    ];
                } else {
                    response = ` **Knowledge Article Synthesis: ${topic}**

I've searched our knowledge base for information about "${topic}". Here's what I found:

**Key Information:**
 Comprehensive Bitcoin troubleshooting guides available
 Step-by-step resolution procedures documented
 Customer communication templates provided
 Technical background and context included

**Best Practices:**
 Always verify technical details before communicating
 Use customer-friendly language
 Provide multiple solution options
 Follow up to ensure resolution

**Recommended approach for customer communication:**`;
                    
                    suggestedActions = [
                        {
                            text: "Provide general guidance",
                            message: "I've reviewed our knowledge base regarding your Bitcoin transaction issue. Based on the information available, I can help you understand what's happening and provide several options to resolve this. Let me explain the situation and what we can do together."
                        },
                        {
                            text: "Offer detailed explanation",
                            message: "I have access to comprehensive troubleshooting guides for your specific Bitcoin issue. Would you like me to walk you through the technical details of what's happening, or would you prefer I focus on the practical solutions we can implement right now?"
                        }
                    ];
                }
            } else if (query.toLowerCase().includes('help me respond to this customer message:')) {
                // Help with customer response
                const customerMessage = query.replace(/help me respond to this customer message:\s*/i, '').replace(/"/g, '').trim();
                
                if (customerMessage.toLowerCase().includes('accelerate') || customerMessage.toLowerCase().includes('cancel')) {
                    response = ` **Help with Customer Response**

**Customer Message Analysis:**
"${customerMessage}"

**Customer Intent:** The customer wants to either accelerate their stuck transaction or cancel it to resend with higher fees.

**Key Points to Address:**
 Acknowledge their frustration with the delay
 Explain that cancellation isn't possible once broadcast
 Offer CPFP acceleration as the solution
 Provide clear cost and timeline expectations

**Recommended Response Strategy:**
 Be empathetic about the wait time
 Educate about Bitcoin transaction mechanics
 Present CPFP as a premium solution
 Give them control over the decision

**Suggested customer responses:**`;
                    
                    suggestedActions = [
                        {
                            text: "Empathetic + Solution-focused",
                            message: "I understand your frustration with the 3+ hour delay, Samuel. Unfortunately, Bitcoin transactions can't be cancelled once broadcast, but I can definitely help accelerate it using CPFP. This would cost an additional $8-12 in network fees and typically confirms within 30 minutes. Would you like me to set this up for you?"
                        },
                        {
                            text: "Educational + Options",
                            message: "Great question! Once a Bitcoin transaction is broadcast to the network, it can't be cancelled - but we have a better solution. I can accelerate your transaction using CPFP (Child Pays for Parent), which creates a second transaction that helps confirm both faster. Cost is $8-12 extra, confirms in ~30 minutes. Alternatively, we can wait 6-12 hours for natural confirmation."
                        },
                        {
                            text: "Direct + Action-oriented",
                            message: "I can help accelerate your transaction right now using our CPFP service. This will cost an additional $8-12 in fees but should get your Bitcoin confirmed within 30 minutes instead of waiting potentially 6-12 hours. Shall I walk you through the acceleration process?"
                        }
                    ];
                } else if (customerMessage.toLowerCase().includes('pending') || customerMessage.toLowerCase().includes('going on')) {
                    response = ` **Help with Customer Response**

**Customer Message Analysis:**
"${customerMessage}"

**Customer Intent:** The customer is confused and concerned about why their Bitcoin withdrawal is taking so long.

**Key Points to Address:**
 Reassure them that their funds are safe
 Explain the technical reason simply
 Avoid overwhelming with technical details
 Offer concrete next steps

**Communication Strategy:**
 Lead with reassurance about fund security
 Use simple analogies (waiting room, priority queue)
 Provide specific timelines and options
 Maintain confident, helpful tone

**Suggested customer responses:**`;
                    
                    suggestedActions = [
                        {
                            text: "Reassuring + Explanatory",
                            message: "Your Bitcoin is completely safe, Samuel! The delay is due to network congestion - think of it like a busy highway where transactions with higher fees get priority. Your transaction is waiting in the mempool (like a waiting room) because it used a lower fee rate. I can help accelerate it or we can wait for natural confirmation."
                        },
                        {
                            text: "Technical + Solutions",
                            message: "I can see exactly what's happening with your withdrawal. Your transaction used 12 sat/vB in fees, but current network demand requires 45 sat/vB for fast confirmation. Your Bitcoin is secure and will definitely process - it's just a matter of timing. I can accelerate it for $8-12 or we can wait 6-12 hours."
                        },
                        {
                            text: "Simple + Action-focused",
                            message: "Your Bitcoin withdrawal is safe but stuck in a queue due to network congestion. The fee was set too low for current demand, so it's waiting for quieter periods. I can either help speed it up (costs $8-12 extra, confirms in 30 min) or we can wait it out (6-12 hours). What would you prefer?"
                        }
                    ];
                } else {
                    response = ` **Help with Customer Response**

**Customer Message Analysis:**
"${customerMessage}"

**Response Strategy:**
I've analyzed the customer's message and here's how to respond effectively:

**Key Considerations:**
 Maintain empathetic and professional tone
 Address their specific concern directly
 Provide clear, actionable next steps
 Reassure about Bitcoin security

**Communication Best Practices:**
 Acknowledge their concern first
 Explain the situation simply
 Offer concrete solutions with timelines
 Give them control over decisions

**Suggested customer responses:**`;
                    
                    suggestedActions = [
                        {
                            text: "Professional response",
                            message: "Thank you for reaching out about this. I understand your concern and I'm here to help resolve this for you. Let me explain what's happening and what options we have available."
                        },
                        {
                            text: "Empathetic response", 
                            message: "I completely understand your frustration with this situation. Your concern is valid, and I want to make sure we get this resolved quickly and clearly for you."
                        },
                        {
                            text: "Solution-focused response",
                            message: "I can help you with this right away. Based on what you've described, here are the specific steps we can take to resolve this situation."
                        }
                    ];
                }
            } else {
                response = `I understand you're asking about: "${query}"

Based on the current case context (Bitcoin withdrawal stuck in mempool), here are some relevant suggestions:

 Check transaction status and mempool position
 Analyze fee rates and provide acceleration options
 Review similar resolved cases for guidance
 Access customer regulatory information
 Use Bitcoin-specific troubleshooting tools

Is there a specific aspect you'd like me to focus on? I can provide detailed analysis for any Bitcoin-related issue.`;
            }
            
            addCopilotMessage(response, 'copilot', suggestedActions);
        }

        function showCopilotTyping() {
            document.getElementById('copilot-typing-indicator').style.display = 'flex';
            const messagesContainer = document.getElementById('copilot-messages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideCopilotTyping() {
            document.getElementById('copilot-typing-indicator').style.display = 'none';
        }

        function clearCopilotChat() {
            const messagesContainer = document.getElementById('copilot-messages');
            const spacer = messagesContainer.querySelector('.space-y-4');
            spacer.innerHTML = ``;
            lucide.createIcons();
        }

        function exportCopilotChat() {
            showNotification('Chat exported to clipboard', 'success');
        }

        function acceptAction(actionTitle, message) {
            // Add the message to the message input
            document.getElementById('message-input').value = message;
            
            // Focus on the input
            document.getElementById('message-input').focus();
            
            // Update character count
            updateCharacterCount('message-input', 'char-count');
            
            // Show reply suggestions after accepting copilot action
            const replySuggestions = document.getElementById('reply-suggestions');
            if (replySuggestions) {
                replySuggestions.style.display = 'block';
            }
            
            // Show notification
            showNotification(`Added suggested response: ${actionTitle}`, 'success');
        }

        function addActionPreview(message) {
            const messagesContainer = document.getElementById('messages-container');
            const previewDiv = document.createElement('div');
            previewDiv.className = 'flex justify-end';
            
            previewDiv.innerHTML = `
                <div class="message-bubble">
                    <div class="action-preview">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs font-medium text-gray-600"> Draft Message</span>
                            <div class="flex gap-2">
                                <button class="btn btn-ghost btn-sm" onclick="editDraft(this)">
                                    <i data-lucide="edit-2" class="w-3 h-3"></i>
                                </button>
                                <button class="btn btn-primary btn-sm" onclick="sendDraft(this, '${message.replace(/'/g, "\\'")}')">
                                    <i data-lucide="send" class="w-3 h-3"></i>
                                </button>
                            </div>
                        </div>
                        <p class="text-sm">${message}</p>
                    </div>
                </div>
            `;
            
            messagesContainer.querySelector('.space-y-4').appendChild(previewDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Re-initialize icons
            lucide.createIcons();
        }

        function sendDraft(button, message) {
            // Remove the preview
            button.closest('.flex').remove();
            
            // Send the message
            addConversationMessage(message, 'advocate');
            
            // Simulate customer response
            setTimeout(() => {
                simulateCustomerResponse();
            }, 2000 + Math.random() * 3000);
        }

        function editDraft(button) {
            const messageText = button.closest('.action-preview').querySelector('p').textContent;
            document.getElementById('message-input').value = messageText;
            
            // Remove the preview
            button.closest('.flex').remove();
            
            // Focus on the input
            document.getElementById('message-input').focus();
        }

        // Conversation Panel Functions
        function sendMessage() {
            const input = document.getElementById('message-input');
            const message = input.value.trim();
            
            if (!message) return;

            // Add message to conversation
            addConversationMessage(message, 'advocate');
            
            // Clear input
            input.value = '';
            updateCharacterCount('message-input', 'char-count');
            
            // Simulate customer response
            setTimeout(() => {
                simulateCustomerResponse();
            }, 2000 + Math.random() * 3000);
        }

        function addConversationMessage(message, sender, suggestions = []) {
            const messagesContainer = document.getElementById('messages-container');
            const messageDiv = document.createElement('div');
            
            const isAdvocate = sender === 'advocate';
            messageDiv.className = `flex ${isAdvocate ? 'justify-end' : 'justify-start'} flex-col`;
            
            const messageClass = isAdvocate ? 'advocate-message' : 'customer-message';
            const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            let suggestionsHTML = '';
            if (!isAdvocate && suggestions.length > 0) {
                suggestionsHTML = `
                    <div class="reply-suggestions mt-2">
                        ${suggestions.map(suggestion => `
                            <div class="reply-pill" onclick="useReplySuggestion('${suggestion.replace(/'/g, "\\'")}')">
                                <i data-lucide="corner-down-left" class="w-3 h-3"></i>
                                ${suggestion}
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            // Help trigger for customer messages
            let helpTriggerHTML = '';
            if (!isAdvocate) {
                helpTriggerHTML = `
                    <div class="help-trigger" data-message="${message.replace(/'/g, "\\'")}" onclick="askForHelp(this.dataset.message)" title="Get help responding to this message">
                        <i data-lucide="help-circle" class="w-3 h-3 text-gray-500"></i>
                    </div>
                `;
            }
            
            messageDiv.innerHTML = `
                <div class="message-bubble ${isAdvocate ? 'self-end' : 'self-start'}">
                    ${!isAdvocate ? '<div class="customer-message-wrapper">' : ''}
                        <div class="${messageClass}">
                            <p class="text-sm">${message}</p>
                        </div>
                        ${helpTriggerHTML}
                    ${!isAdvocate ? '</div>' : ''}
                    <div class="flex items-center gap-2 mt-1 ${isAdvocate ? 'justify-end' : ''}">
                        ${isAdvocate ? '<span class="text-xs text-gray-400">Read</span><span class="text-xs text-gray-400"></span>' : ''}
                        <span class="text-xs text-gray-500">${time}</span>
                        ${!isAdvocate ? '<span class="text-xs text-gray-400"></span><span class="text-xs text-gray-400">Delivered</span>' : ''}
                    </div>
                </div>
                ${suggestionsHTML}
            `;
            
            messagesContainer.querySelector('.space-y-4').appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Re-initialize icons
            lucide.createIcons();
        }

        function useReplySuggestion(suggestion) {
            // Set the suggestion in the message input
            document.getElementById('message-input').value = suggestion;
            
            // Focus on the input
            document.getElementById('message-input').focus();
            
            // Update character count
            updateCharacterCount('message-input', 'char-count');
        }

        function simulateCustomerResponse() {
            const responses = [
                {
                    message: "Thank you for the explanation! How long will the CPFP process take?",
                    suggestions: [
                        "CPFP typically takes 30-60 minutes to confirm once we create the child transaction.",
                        "I can set up the CPFP transaction now - it should confirm within the next block.",
                        "The process itself is quick, but network confirmation depends on current congestion."
                    ]
                },
                {
                    message: "I understand now. Can you help me set up the child transaction?",
                    suggestions: [
                        "Absolutely! I'll guide you through the CPFP setup step by step.",
                        "Yes, I can help you create the child transaction. Let me walk you through it.",
                        "I'll help you set this up right away. First, let me verify your transaction details."
                    ]
                },
                {
                    message: "This is frustrating. Why doesn't the app warn about low fees?",
                    suggestions: [
                        "I understand your frustration. We're working on better fee estimation in the app.",
                        "You're right - better fee warnings would help. Let me focus on resolving this now.",
                        "I apologize for the inconvenience. Our team is improving the fee estimation feature."
                    ]
                },
                {
                    message: "Okay, I'll wait. Can you send me updates on the transaction status?",
                    suggestions: [
                        "Of course! I'll monitor your transaction and send updates every hour.",
                        "I'll track it for you and notify you as soon as it confirms.",
                        "I'll set up automatic notifications for any status changes on your transaction."
                    ]
                },
                {
                    message: "I appreciate your help. What should I do differently next time?",
                    suggestions: [
                        "For future transactions, I recommend checking current network fees first.",
                        "Next time, use the 'Priority' fee option during high network congestion.",
                        "I'll send you a guide on optimal Bitcoin fee selection for different situations."
                    ]
                }
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            addConversationMessage(randomResponse.message, 'customer', randomResponse.suggestions);
        }

        function showTypingIndicator() {
            document.getElementById('typing-indicator').style.display = 'flex';
            setTimeout(() => {
                document.getElementById('typing-indicator').style.display = 'none';
            }, 3000);
        }

        function showInitialCaseAnalysis() {
            const initialAnalysis = document.getElementById('initial-analysis');
            if (initialAnalysis) {
                initialAnalysis.style.display = 'flex';
                initialAnalysis.classList.add('animate-fade-in-up');
                
                // Scroll to show the analysis
                const messagesContainer = document.getElementById('copilot-messages');
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                // Re-initialize icons
                lucide.createIcons();
            }
        }

        function toggleCaseSummary() {
            const pill = document.getElementById('case-summary-pill');
            const content = document.getElementById('case-summary-content');
            const icon = document.getElementById('case-summary-icon');
            
            if (content.classList.contains('expanded')) {
                // Collapse
                content.classList.remove('expanded');
                pill.classList.remove('expanded');
                icon.setAttribute('data-lucide', 'chevron-down');
            } else {
                // Expand
                content.classList.add('expanded');
                pill.classList.add('expanded');
                icon.setAttribute('data-lucide', 'chevron-up');
            }
            
            // Re-initialize icons
            lucide.createIcons();
        }

        function askKnowledge(topic) {
            // Switch to copilot tab if not already active
            if (currentTab !== 'copilot') {
                switchTab('copilot');
            }

            // Set the knowledge query in the input
            document.getElementById('copilot-input').value = `Tell me about: ${topic}`;
            
            // Send the query
            sendCopilotQuery();
        }

        function askForHelp(customerMessage) {
            // Switch to copilot tab if not already active
            if (currentTab !== 'copilot') {
                switchTab('copilot');
            }

            // Create help query
            const helpQuery = `Help me respond to this customer message: "${customerMessage}"`;
            
            // Set the query in the input
            document.getElementById('copilot-input').value = helpQuery;
            
            // Send the query
            sendCopilotQuery();
            
            // Show notification
            showNotification('Asking copilot for help with customer response', 'info');
        }

        function useReplyPill(message) {
            // Add the reply to the message input
            document.getElementById('message-input').value = message;
            
            // Focus on the input
            document.getElementById('message-input').focus();
            
            // Update character count
            updateCharacterCount('message-input', 'char-count');
            
            // Hide reply suggestions
            const suggestions = document.getElementById('reply-suggestions');
            if (suggestions) {
                suggestions.style.display = 'none';
            }
            
            // Show notification
            showNotification('Reply added to message input', 'success');
        }

        function switchToAccount(accountType) {
            // Update account card states
            document.querySelectorAll('.account-card').forEach(card => {
                card.classList.remove('active');
            });
            
            const activeCard = document.querySelector(`[data-account="${accountType}"]`);
            if (activeCard) {
                activeCard.classList.add('active');
            }
            
            // Update account actions based on selected account
            updateAccountActions(accountType);
            
            // Show notification
            const accountNames = {
                'personal': 'Personal Account',
                'business': 'Business Account', 
                'savings': 'Savings Account'
            };
            showNotification(`Switched to ${accountNames[accountType]}`, 'success');
        }

        function updateAccountActions(accountType) {
            const actions = document.getElementById('account-actions');
            const accountNames = {
                'personal': 'Samuel L. Jackson personal account',
                'business': 'Samuel L. Jackson business account',
                'savings': 'Samuel L. Jackson savings account'
            };
            
            const accountName = accountNames[accountType];
            
            actions.innerHTML = `
                <button class="btn btn-tertiary btn-sm flex-1 focus-visible" onclick="askCopilot('Show me regulatory information for ${accountName}')">
                    <i data-lucide="external-link" class="w-3 h-3 mr-1"></i>
                    Regulator
                </button>
                <button class="btn btn-tertiary btn-sm flex-1 focus-visible" onclick="askCopilot('Open advocate toolbox for ${accountName}')">
                    <i data-lucide="wrench" class="w-3 h-3 mr-1"></i>
                    Toolbox
                </button>
            `;
            
            // Re-initialize icons
            lucide.createIcons();
        }

        // Utility Functions
        function updateCharacterCount(inputId, counterId) {
            const input = document.getElementById(inputId);
            const counter = document.getElementById(counterId);
            const count = input.value.length;
            counter.textContent = `${count}/1000`;
            
            if (count > 900) {
                counter.style.color = 'var(--destructive)';
            } else if (count > 800) {
                counter.style.color = '#f59e0b';
            } else {
                counter.style.color = 'var(--muted-foreground)';
            }
        }

        function handleKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function handleCopilotKeyDown(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendCopilotQuery();
            }
        }

        function toggleCopilot() {
            showNotification('Copilot panel minimized', 'info');
        }

        function attachFile() {
            showNotification('File attachment feature coming soon', 'info');
        }

        function addEmoji() {
            const input = document.getElementById('message-input');
            input.value += ' ';
            updateCharacterCount('message-input', 'char-count');
        }

        function showNotification(message, type = 'info') {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="flex items-center gap-2">
                    <i data-lucide="${type === 'success' ? 'check-circle' : 'info'}" class="w-4 h-4"></i>
                    <span class="text-sm">${message}</span>
                </div>
            `;
            
            container.appendChild(notification);
            
            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Hide notification
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    container.removeChild(notification);
                }, 300);
            }, 3000);
            
            lucide.createIcons();
        }

        // Initialize icons on load
        document.addEventListener('DOMContentLoaded', function() {
            lucide.createIcons();
        });

        // Enhanced Account switching with subtle animations
        function switchAccount(accountId) {
            // Remove active class from all account cards
            document.querySelectorAll('.account-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // Add active class to selected account
            const selectedCard = document.querySelector(`[data-account="${accountId}"]`);
            if (selectedCard) {
                selectedCard.classList.add('active');
            }
            
            // Update account display with subtle animation
            const accountDisplay = document.getElementById('account-display');
            const accountData = {
                personal: { name: 'Personal Account', balance: '0.00234 BTC', label: 'EIDV' },
                business: { name: 'Business Account', balance: '0.15678 BTC', label: 'Verified' },
                trading: { name: 'Trading Account', balance: '0.89012 BTC', label: 'Pro' }
            };
            
            const data = accountData[accountId];
            if (data) {
                // Simple fade transition
                accountDisplay.style.opacity = '0.5';
                setTimeout(() => {
                    accountDisplay.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-foreground">${data.name}</h3>
                                <p class="text-sm text-muted-foreground">${data.balance}</p>
                            </div>
                            <div class="badge badge-outline">${data.label}</div>
                        </div>
                    `;
                    accountDisplay.style.opacity = '1';
                }, 100);
            }
        }
        
        // Enhanced card click interactions
        document.addEventListener('click', function(e) {
            const card = e.target.closest('.interactive-card, .card');
            if (card) {
                // Add subtle click feedback
                card.style.transform = 'translateY(0)';
                setTimeout(() => {
                    card.style.transform = '';
                }, 100);
            }
        });

        // Collapsible module functions
        function toggleModule(moduleId) {
            const content = document.getElementById(`${moduleId}-content`);
            const chevron = document.getElementById(`${moduleId}-chevron`);
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                chevron.setAttribute('data-lucide', 'chevron-up');
            } else {
                content.style.display = 'none';
                chevron.setAttribute('data-lucide', 'chevron-down');
            }
            
            // Re-initialize icons
            lucide.createIcons();
            
            // Trigger height adjustment for panels
            adjustPanelHeights();
        }

        // Dynamic panel height adjustment
        function adjustPanelHeights() {
            const leftPanel = document.querySelector('.left-panel');
            const middlePanel = document.querySelector('.middle-panel');
            const rightPanel = document.querySelector('.right-panel');
            
            if (leftPanel && middlePanel && rightPanel) {
                // Only adjust on desktop (768px+)
                if (window.innerWidth > 768) {
                    // Calculate viewport height minus container padding
                    const viewportHeight = window.innerHeight;
                    const containerPadding = parseFloat(getComputedStyle(document.querySelector('.container')).paddingTop) * 2;
                    const availableHeight = viewportHeight - containerPadding;
                    
                    // Calculate the actual content height of the left panel
                    const leftPanelContent = leftPanel.scrollHeight;
                    
                    // Use the larger of viewport height or left panel content height
                    const targetHeight = Math.max(availableHeight, leftPanelContent);
                    
                    // Apply height to all panels
                    [middlePanel, rightPanel].forEach(panel => {
                        panel.style.minHeight = `${targetHeight}px`;
                        panel.style.transition = 'min-height 0.3s ease-out';
                    });
                } else {
                    // Reset heights on mobile
                    [middlePanel, rightPanel].forEach(panel => {
                        panel.style.minHeight = 'auto';
                    });
                }
            }
        }

        // Adjust panel heights on window resize and load
        window.addEventListener('resize', adjustPanelHeights);
        window.addEventListener('load', adjustPanelHeights);
        document.addEventListener('DOMContentLoaded', adjustPanelHeights);

        // Knowledge base toggle function
        function toggleKnowledgeBase() {
            const container = document.getElementById('knowledge-pills-container');
            const chevron = document.getElementById('knowledge-base-chevron');
            
            if (container.style.display === 'none') {
                container.style.display = 'flex';
                chevron.setAttribute('data-lucide', 'chevron-up');
            } else {
                container.style.display = 'none';
                chevron.setAttribute('data-lucide', 'chevron-down');
            }
            
            // Re-initialize icons
            lucide.createIcons();
        }
          </script>
  </body>
</html> 